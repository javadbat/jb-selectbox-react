'use strict';function _interopDefault(a){return a&&"object"==typeof a&&"default"in a?a["default"]:a}var React=_interopDefault(require("react")),JBSelectBoxData=_interopDefault(require("./JBSelectBoxData.cjs.min")),mobx=require("mobx"),mobxReact=require("mobx-react");require("./JBSelectBox.css");var _class,_descriptor,_temp;function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _applyDecoratedDescriptor(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}function _initializerWarningHelper(){throw new Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and set to use loose mode. To use proposal-class-properties in spec mode with decorators, wait for the next major version of decorators in stage 2.")}var _class$1,JBSelectBoxService=(_class=(_temp=function(){function a(b){var c=this;_classCallCheck(this,a),_defineProperty(this,"defaultConfig",new JBSelectBoxData),_defineProperty(this,"config",void 0),_defineProperty(this,"props",void 0),_defineProperty(this,"Dropstatus",_initializerWarningHelper(_descriptor,this)),_defineProperty(this,"elements",{inputField:null,listElement:null}),this.props=b,this.config=this.mergeObject(b.config,this.defaultConfig),mobx.observe(this.config,"options",function(a){return c.onComponentPropsChange(a)}),this.componentClassNames=b.className,this.onChangeEvent=b.onChange,this.config.triggers.resetStates=function(){return c.resetStates()},this.config.triggers.focus=function(){return c.focusOnSelectBox()},this.standardConfig(),(!0==b.autoFocus||"true"==b.autoFocus)&&(this.config.autoFocus=!0)}return _createClass(a,[{key:"isShowListEmpty",get:function(){var a=!0;return this.config.options.forEach(function(b){if(!1==b.JBSelectBoxDetail.hidden)return void(a=!1)}),a}}]),_createClass(a,[{key:"onComponentPropsChange",value:function(a){var b=this;"options"==a.name&&(a.newValue.forEach(function(a){b.defineJBSelectBoxDetail(a)}),this.config.options=a.newValue)}},{key:"mergeObject",value:function(a,b){var c={};for(var d in b)(null==a[d]||null==a[d])&&(c[d]=b[d]);return mobx.extendObservable(a,c),a}},{key:"standardConfig",value:function(){var a=this;if(this.config.options.map(function(b){a.defineJBSelectBoxDetail(b)}),this.config.allowFreeSelect&&(this.config.options.unshift({caption:"",value:""}),this.defineJBSelectBoxDetail(this.config.options[0]),this.config.options[0].JBSelectBoxDetail.isFreeOptionRow=!0),mobx.intercept(this.config,"options",function(b){return 0<b.newValue.length&&b.newValue.map(function(b){a.defineJBSelectBoxDetail(b)}),setTimeout(function(){return a.UpdateValueByOptions()},0),b}),!this.props.config.fieldsNames){var b={fieldsNames:mobx.toJS(this.config.fieldsNames)};mobx.extendObservable(this.props.config,b)}mobx.intercept(this.props.config,"fieldsNames",function(b){a.config.fieldsNames=b.newValue})}},{key:"makeSelectedValueNull",value:function(){this.config.value=null,this.elements.inputField.value=""}},{key:"UpdateValueByOptions",value:function(a){var b=this;a||(a=this.props.value);var c=this.config.options.find(function(c){return c[b.config.fieldsNames.value]==a});c||(c=this.config.options.find(function(c){return c[b.config.fieldsNames.caption]==a})),c&&(this.config.value=c,this.elements.inputField.value=c[this.config.fieldsNames.caption])}},{key:"onInputFocus",value:function(){this.focusOnSelectBox()}},{key:"focusOnSelectBox",value:function(){var a=this;this.Dropstatus.show=!0,this.focusStatus=!0,setTimeout(function(){a.elements.inputField.focus()},0),this.config.options[0]&&this.setActiveMenuItem(this.config.options[0]),this.hideAddFreeRowOption()}},{key:"hideAddFreeRowOption",value:function(){var a=this.config.options.find(function(a){return a.JBSelectBoxDetail.isFreeOptionRow});a&&""==this.elements.inputField.value&&(a.JBSelectBoxDetail.addFreeRowOptionHidden=!0)}},{key:"onInputblur",value:function(){var a=this;if(this.focusStatus)if(setTimeout(function(){a.Dropstatus.show=!1,a.focusStatus=!1,a.resetSearchHidden()},200),!this.config.value)this.config.allowFreeSelect?this.selectCurrentActiveMenu():this.elements.inputField.value="";else if((this.config.value[this.config.fieldsNames.value]||this.config.value[0<this.config.fieldsNames.caption.length])&&(""==this.elements.inputField.value&&this.config.allowNull?this.resetStates():this.elements.inputField.value=this.config.value[this.config.fieldsNames.caption]),this.config.allowFreeSelect);}},{key:"setActiveMenuItem",value:function(a){var b=this.getActiveMenuItem();b&&(b.JBSelectBoxDetail.active=!1),a&&(a.JBSelectBoxDetail.active=!0)}},{key:"DeactivateMenuItem",value:function(){var a=this.getActiveMenuItem();a&&(a.JBSelectBoxDetail.active=!1)}},{key:"onInputKeyUp",value:function(a){switch(a.keyCode){case 40:var b=this.getActiveMenuItemIndex(),c=this.SetActiveMenuItemIndexToNext(b);this.setScroll(a,c);break;case 38:var b=this.getActiveMenuItemIndex(),c=this.SetActiveMenuItemIndexToPrev(b);this.setScroll(a,c);break;case 13:this.selectCurrentActiveMenu();break;default:return this.config.allowFreeSelect&&this.updateAddFreeRowOption(a.target.value),this.config.callbacks.onFilterTextChange&&this.config.callbacks.onFilterTextChange(a),this.filterMenuListByString(a.target.value),!0;}}},{key:"setScroll",value:function(a,b){var c=this.elements.listElement.scrollTop,d=this.config.options[b].JBSelectBoxDetail.optionDom.offsetTop,e=this.elements.listElement.clientHeight;d>c+e&&this.elements.listElement.scroll(0,d),d<c&&this.elements.listElement.scroll(0,c-e)}},{key:"updateAddFreeRowOption",value:function(a){var b=this.config.options.find(function(a){return a.JBSelectBoxDetail.isFreeOptionRow});""==a?b.JBSelectBoxDetail.addFreeRowOptionHidden=!0:(b[this.config.fieldsNames.value]=a,b[this.config.fieldsNames.caption]=a,b.JBSelectBoxDetail.addFreeRowOptionHidden=!1)}},{key:"selectCurrentActiveMenu",value:function(){var a=this.getActiveMenuItem();!a||a.JBSelectBoxDetail.hidden||this.selectItem(a)}},{key:"selectItem",value:function(a){this.config.triggers.beforeChange&&this.config.triggers.beforeChange({selectedItem:a}),this.config.value=a,this.onChangeEvent&&this.onComponentValueChange(),this.Dropstatus.show=!1,this.elements.inputField.value=a[this.config.fieldsNames.caption]}},{key:"SetActiveMenuItemIndexToNext",value:function(a){var b=this;a==this.config.options.length-1&&(a=-1);var c=a+1;return this.config.options.forEach(function(a,d){if(!0==b.config.options[c].JBSelectBoxDetail.hidden&&(c++,c==b.config.options.length&&(c=0),d+1==b.config.options.length))return-1}),this.setActiveMenuItem(this.config.options[c]),c}},{key:"SetActiveMenuItemIndexToPrev",value:function(a){var b=this;0==a&&(a=this.config.options.length);var c=a-1;return this.config.options.forEach(function(a,d){if(!0==b.config.options[c].JBSelectBoxDetail.hidden&&(c--,-1==c&&(c=b.config.options.length-1),d+1==b.config.options.length));}),this.setActiveMenuItem(this.config.options[c]),c}},{key:"filterMenuListByString",value:function(a){var b=this,c=!1;if(this.config.options.forEach(function(d){d[b.config.fieldsNames.caption].includes(a)?d.JBSelectBoxDetail.searchHidden=!1:(d.JBSelectBoxDetail.searchHidden=!0,!0==d.JBSelectBoxDetail.active&&(c=!0))}),this.isShowListEmpty)this.getActiveMenuItemIndex();c&&this.SetActiveMenuItemIndexToNext(-1)}},{key:"getActiveMenuItem",value:function(){var a=this,b=this.config.options.find(function(b){if(a.defineJBSelectBoxDetail(b),!0==b.JBSelectBoxDetail.active)return b});return b}},{key:"getActiveMenuItemIndex",value:function(){var a=this,b=this.config.options.findIndex(function(b){if(a.defineJBSelectBoxDetail(b),!0==b.JBSelectBoxDetail.active)return b});return b}},{key:"defineJBSelectBoxDetail",value:function(a){"object"!=_typeof(a.JBSelectBoxDetail)&&mobx.extendObservable(a,{JBSelectBoxDetail:{hidden:mobx.computed(function(){return this.searchHidden||this.externalHidden||this.addFreeRowOptionHidden}),active:!1,searchHidden:!1,externalHidden:!1,addFreeRowOptionHidden:!1,isFreeOptionRow:!1}})}},{key:"resetStates",value:function(){this.config.value=null,this.elements.inputField.value="",this.resetSearchHidden()}},{key:"resetSearchHidden",value:function(){this.config.options.forEach(function(a){a.JBSelectBoxDetail.searchHidden=!1})}},{key:"onComponentFocus",value:function(){this.elements.inputField.focus()}},{key:"onComponentValueChange",value:function(){var a=this,b=this.config.value[this.config.fieldsNames.value];b||(b=this.config.value[this.config.fieldsNames.caption]);var c=new CustomEvent("change",{detail:{newValue:b,newValueObject:this.config.value},bubbles:!0,cancelable:!0});c.simulated=!0;var d=this.JBSelectBoxComponentDom._valueTracker;d&&d.setValue(b),this.JBSelectBoxComponentDom.value=b,this.JBSelectBoxComponentDom.onchange=function(b){return a.onChangeEvent(b)},this.JBSelectBoxComponentDom.dispatchEvent(c)}},{key:"observeValue",value:function(){}}]),a}(),_temp),_descriptor=_applyDecoratedDescriptor(_class.prototype,"Dropstatus",[mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{show:!1}}}),_applyDecoratedDescriptor(_class.prototype,"isShowListEmpty",[mobx.computed],Object.getOwnPropertyDescriptor(_class.prototype,"isShowListEmpty"),_class.prototype),_class);function _typeof$1(a){return _typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof$1(a)}function _classCallCheck$1(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass$1(a,b,c){return b&&_defineProperties$1(a.prototype,b),c&&_defineProperties$1(a,c),a}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof$1(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}var JBSelectBox=mobxReact.observer(_class$1=function(a){function b(a){var c;return _classCallCheck$1(this,b),c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a)),c.service=new JBSelectBoxService(a),c}return _inherits(b,a),_createClass$1(b,[{key:"componentWillReceiveProps",value:function(a){var b=!1;null==this.service.config.value&&null!=a.value&&(b=!0),null!=this.service.config.value&&null==a.value&&this.service.makeSelectedValueNull(),this.service.config.value&&a.value!=this.service.config.value[this.service.config.fieldsNames.value]&&(b=!0),b&&this.service.UpdateValueByOptions(a.value)}},{key:"componentDidMount",value:function(){!0==this.service.config.autoFocus&&this.service.onComponentFocus()}},{key:"render",value:function(){var a=this;return React.createElement("div",{className:"jb-select-box-component "+this.service.componentClassNames,onFocus:function(b){return a.service.onComponentFocus(b)},ref:function(b){a.service.JBSelectBoxComponentDom=b}},React.createElement("section",{key:"1",className:"input-field"},React.createElement("input",{placeholder:this.service.config.placeHolder,type:"text",onFocus:function(b){return a.service.onInputFocus(b)},onBlur:function(b){return a.service.onInputblur(b)},onKeyUp:function(b){a.service.onInputKeyUp(b)},ref:function(b){a.service.elements.inputField=b}}),React.createElement("div",{key:"3",className:"icon-wrapper",onClick:function(b){return a.service.onInputFocus(b)}},this.service.config.isLoading&&React.createElement("svg",{class:"circular-loader",viewBox:"25 25 50 50"},React.createElement("circle",{class:"loader-path",cx:"50",cy:"50",r:"20",fill:"none"})),!this.service.config.isLoading&&React.createElement("svg",{viewBox:"0 0 800 800",class:"arrow-icon"},React.createElement("polygon",{points:"0,200 800,200 400,600"})))),React.createElement("section",{key:"2",className:"input-list "+(this.service.Dropstatus.show?"":"hidden"),ref:function(b){return a.service.elements.listElement=b}},React.createElement("ul",null,this.service.config.options.map(function(b,c){if(!b.JBSelectBoxDetail.hidden)return React.createElement("li",{onClick:function(){return a.service.selectItem(b)},onMouseOver:function(){return a.service.setActiveMenuItem(b)},className:""+(b.JBSelectBoxDetail.active?"active":"")+(b.JBSelectBoxDetail.isFreeOptionRow?" free-option-row":""),key:"jb-select-item-"+c,value:b[a.service.config.fieldsNames.value],ref:function(a){return b.JBSelectBoxDetail.optionDom=a}},b[a.service.config.fieldsNames.caption]," ")}),this.service.isShowListEmpty&&React.createElement("li",{className:"empty-list-caption"},"\u0645\u0648\u0631\u062F\u06CC \u0628\u0631\u0627\u06CC \u0627\u0646\u062A\u062E\u0627\u0628 \u0648\u062C\u0648\u062F \u0646\u062F\u0627\u0631\u062F"))))}}]),b}(React.Component))||_class$1;module.exports=JBSelectBox;
